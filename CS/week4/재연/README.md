<strong>목차</strong>

[1. CPU스케줄링](#CPU스케줄링)

[2. 데드락](#데드락)

[3. 경쟁상태](#경쟁상태)

[4. 뮤텍스와 세마포어](#뮤텍스와-세마포어)



## CPU스케줄링

프로세스는 생성된 후부터 종료될 때까지 CPU 스케줄러에 의해 관리된다. 이러한 프로세스들이 실행될 때 어떤 프로세스를 CPU에 배정할 지 결정하는 것을 CPU 스케줄링이라고 한다.

이러한 스케줄링에는 CPU를 할당 받아 실행 중인 프로세스를 OS가 강제로 빼앗아 다른 프로세스에게 자원을 할당하는 선점형 스케줄링과 뺏지 않는 비선점형 스케줄링이 있다.



<strong>CPU 스케줄링의 종류</strong>

- 비선점형 스케줄링
  - FCFS(First Come First Served)
    - 큐에 도착한 순서대로 CPU 자원을 할당한다.
    - 실행 시간이 긴 프로세스가 CPU를 할당 받으면 뒤에 있는 프로세스들의 평균 대기 시간이 길어진다.
  - SJF(Shortest Job First)
    - 수행시간이 짧은 프로세스가 CPU 자원을 먼저 할당받는다.
    - 짧은 프로세스가 계속 들어온다면 실행 시간이 긴 프로세스는 CPU를 할당 받지 못해 기아 현상이 나타난다.
  - HRN(Highest Response Ratio Next)
    - SJF 스케줄링에 Aging 기법을 합친 알고리즘이다.
    - SJF의 기아 현상을 해결하기 위해 대기 시간이 길어지면 Aging 값을 높여주어 우선 순위를 높이는 방식이다.
- 선점형 스케줄링
  - Priority Scheduling
    - 프로세스마다 우선순위를 부여하여 우선순위가 높은 순서대로 CPU 자원을 할당받는다.
    - 우선순위가 낮은 프로세스의 기아 현상이 발생할 수 있다.
      - Aging 기법을 통해 해결할 수 있다.
  - RR(Round Robin)
    - 프로세스에게 동일한 시간(타임 슬라이스, Time Quantum)을 할당하는 방법으로 모든 프로세스는 동일한 시간 동안만 자원을 사용할 수 있다.
    - 타임 슬라이스를 어떻게 설정하느냐에 따라 성능의 차이가 발생한다.
      - 타임 슬라이스가 큰 경우에는 FCFS와 같게 된다.
      - 타임 슬라이스가 작은 경우에는 잦은 Context Switching으로 오버헤드가 커진다.
  - MultiLevel Queue
    - 프로세스는 각각의 특성이 모두 다르다. 따라서 적합한 스케줄링이 다르기 때문에 여러 개의 준비 큐를 두어 우선순위를 부여하고 높은 우선순위부터 CPU에 할당하는 방법이다.
    - 우선순위가 낮은 프로세스들의 기아 현상이 발생할 수 있다.
  - MultiLevel Feedback Queue
    - 기본 방식은 MultiLevel Queue와 같지만 프로세스가 기존에 있던 큐에서 다른 준비 큐로 이동이 가능한 방법이다.
    - 준비 큐 간에 이동이 가능해지므로 우선순위가 낮은 프로세스가 큐에서 오래 기다리면 우선순위를 높여주는 Aging 기법을 사용하여 기아 현상을 해결할 수 있다.





## 데드락

데드락(DeadLock)은 자원을 가지고 있는 여러 프로세스가 서로의 자원을 얻으려고 할 때 발생하는 것으로, 교착상태라고도 부른다.

예를 들어, 프로세스 A가 자원 1을 가지고 있고 자원 2를 얻어야하고, 프로세스 B가 자원 2를 가지고 있고 자원 1을 얻어야 한다면 두 프로세스는 서로가 가진 자원을 가지기 위해 무한히 기다리게 되고 이를 교착상태에 빠졌다고 한다.



<strong>데드락이 발생하는 경우</strong>

데드락은 다음 4가지 조건이 동시에 성립해야 발생한다.

- 상호배제(Mutual Exclusion)
  - 자원은 한 번에 한 프로세스 만이 사용할 수 있어야 한다.
- 점유 대기(Hold and Wait)
  - 최소한 하나의 자원을 점유하고 있으면서 다른 프로세스에 할당되어 사용하고 있는 자원을 추가로 점유하기 위해 대기하는 프로세스가 있어야 한다.
- 비선점(No Preemption)
  - 다른 프로세스에 할당된 자원은 사용이 끝날 때까지 강제로 빼앗을 수 없다.
- 순환 대기(Circular Wait)
  - 프로세스의 집합에서 순환 형태로 자원을 대기하고 있어야 한다.



<strong>데드락의 처리</strong>

1. 예방

- 교착 상태 발생 조건 중 하나를 제거함으로 써 해결하는 방법
  - 상호 배제 부정
    - 여러 개의 프로세스가 공유 자원을 사용할 수 있도록 한다.
  - 점유 대기 부정
    - 프로세스가 실행되기 전 필요한 모든 자원을 할당한다.
  - 비선점 부정
    - 자원을 점유하고 있는 프로세스가 다른 자원을 요구할 때 점유하고 있는 자원을 반납하고, 요구한 자원을 사용하기 위해 기다리게 한다.
  - 순환 대기 부정
    - 자원에 고유한 번호를 할당하고, 번호 순서대로 자원을 요구하도록 한다.

2. 회피

- 교착 상태가 발생하면 피해나가는 방법
  - 은행원 알고리즘이 있다.
    - 프로세스의 자원 요청에 안전 상태를 유지할 수 있는 요구만을 수락하고 불안전 상태를 초래할 경우 거절하는 방법이다.
    - 자원을 할당해도 안전 상태가 되는지 검사를 해주어야 한다.
    - 안전 상태란 교착 상태를 일으키지 않으면서 프로세스가 요구한 자원을 모두 할당해줄 수 있는 순서가 존재하는 상태이다.
    - 불안전 상태는 안전 상태를 유지할 순서가 존재하지 않는 상태이다.
    - 은행원 알고리즘이 제대로 수행되기 위한 3가지 조건
      - 각 프로세스가 자원을 최대로 얼마나 요청하는지
      - 각 프로세스가 현재 보유하고 있는 자원은 얼마인지
      - 시스템이 자원을 얼마나 보유하고 있는지

3. 탐지

- 자원 할당 그래프를 통해 교착 상태를 탐지하는 방법
- 자원 요청 시, 탐지 알고리즘을 실행시키므로 오버헤드가 발생한다.

4. 회복

- 교착 상태를 일으킨 프로세스를 종료하거나, 할당된 자원을 해제시켜 회복하는 방법
- 프로세스 종료 방법
  - 교착 상태의 프로세스를 모두 중지시킨다.
  - 교착 상태가 제거될 때까지 하나씩 프로세스를 중지시킨다.
- 자원 선점 방법
  - 교착 상태의 프로세스가 점유하고 있는 자원을 선점해 다른 프로세스에게 할당(해당 프로세스를 일시 정지 시킨다.)
  - 우선 순위가 낮은 프로세스나 수행 횟수가 적은 프로세스 위주로 자원을 선점한다.





## 경쟁상태

경쟁상태(Race Condition)은 공유 자원에 대해 여러 프로세스가 동시에 접근할 때, 결과 값에 영향을 줄 수 있는 상태



<strong>경쟁 상태가 발생하는 경우</strong>

- 커널 작업을 수행하는 중에 인터럽트 발생
  - 커널 모드에서 데이터를 로드하여 작업을 수행하다가 인터럽트가 발생하여 같은 데이터를 조작하는 경우
  - 커널 모드에서 작업을 수행하는 동안 인터럽트를 하지 못하게 하여 CPU 제어권을 가져가지 못하게 한다.
- 프로세스가 System Call을 하여 커널 모드로 진입하여 작업을 수행하는 도중 Context Switching이 일어난 경우
  - 한 프로세스가 커널모드에서 데이터를 조작하는 중 시간이 초과되어 다른 프로세스로 제어가 넘어가 같은 데이터를 조작하는 경우
  - 프로세스가 커널모드에서 작업을 수행하는 동안 시간이 초과되어도 CPU 제어권이 다른 프로세스에게 넘어가게 하지 않는다.
- 멀티 프로세스 환경에서 공유 메모리 내에 커널 데이터에 접근할 때
  - 멀티 프로세스 환경에서 2개의 CPU가 동시에 커널 내부의 공유 데이터에 접근하는 경우
  - 커널 내부에 있는 각 공유 데이터에 접근할 때마다 lock/unlock을 사용한다.





## 뮤텍스와 세마포어

- 뮤텍스(Mutex)
  - 뮤텍스는 상호배제(Mutual Exclution)의 약자이다.
  - 공유된 자원의 데이터를 여러 쓰레드가 접근하는 것을 막는 방법이다.
  - 뮤텍스는 Locking 메커니즘을 사용하여 여러 쓰레드들 중에서 하나의 쓰레드 만이 임계 영역에 들어갈 수 있다.
    - 또한 임계 영역에 들어간 쓰레드만이 Lock을 해제할 수 있다.

- 세마포어

  - 세마포어는 공유된 자원의 데이터를 여러 프로세스 혹은 쓰레드가 접근하는 것을 막는 것이다.

  - Signaling 메커니즘을 사용하여 현재 수행중인 프로세스가 아닌 다른 프로세스가 세마포어를 해제할 수 있다.



<strong>임계 구역(Critical Section)</strong>

임계 영역이란 여러 프로세스가 데이터를 공유하며 수행될 때, 각 프로세스에서 공유 데이터를 접근하는 프로그램 코드 부분을 의미한다.

공유 데이터를 여러 프로세스가 동시에 접근하면 잘못된 결과를 만들 수 있기 때문에, 한 프로세스가 임계 구역을 수행할 때는 다른 프로세스가 접근하지 못하도록 해야 한다.



<strong>차이점</strong>

- 세마포어는 뮤텍스가 될 수 있지만, 뮤텍스는 세마포어가 될 수 없다.
  - 뮤텍스는 상태가 0, 1이기 때문에 이진 세마포어라고도 한다.
- 세마포어는 소유할 수 없지만, 뮤텍스는 소유가 가능하며 소유주가 책임을 진다.
- 뮤텍스는 뮤텍스를 소유한 쓰레드만이 해제할 수 있지만, 세마포어는 세마포어를 소유하지 않아도 해제할 수 있다.
- 세마포어는 시스템 범위에 걸쳐있고 파일 시스템 상의 파일로 존재하지만, 뮤텍스는 프로세스의 범위를 가지며 프로세스가 종료될 때 자동으로 Clean Up된다.
- 관리하는 동기화 대상이 뮤텍스는 하나일 때, 세마포어는 하나 이상일 때 사용된다.